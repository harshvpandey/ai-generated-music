<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JioAI Music - Birthday Celebration</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&display=swap"
    rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            background: '#000000',
            foreground: '#ffffff',
            card: 'rgba(255, 255, 255, 0.05)',
            'card-foreground': '#ffffff',
            primary: '#6366f1', // Indigo
            'primary-foreground': '#ffffff',
            secondary: 'rgba(255, 255, 255, 0.1)',
            'secondary-foreground': '#e2e8f0',
            accent: '#a855f7', // Purple
            muted: 'rgba(255, 255, 255, 0.05)',
            'muted-foreground': '#94a3b8',
            border: 'rgba(255, 255, 255, 0.1)',
          },
          fontFamily: {
            sans: ['Outfit', 'sans-serif'],
            body: ['Outfit', 'sans-serif'],
          }
        }
      }
    }
  </script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Outfit', sans-serif;
      background: #000000;
      color: white;
      min-height: 100vh;
      overflow-x: hidden;
      position: relative;
    }

    /* Animated Background */
    .blob {
      position: absolute;
      border-radius: 50%;
      filter: blur(80px);
      opacity: 0.4;
      z-index: 0;
      pointer-events: none;
    }

    .blob-1 {
      top: -10%;
      left: -10%;
      width: 500px;
      height: 500px;
      background: #4f46e5;
      animation: blob 25s infinite alternate;
    }

    .blob-2 {
      bottom: -10%;
      right: -10%;
      width: 500px;
      height: 500px;
      background: #db2777;
      animation: blob 25s infinite alternate-reverse;
    }

    .blob-3 {
      top: 40%;
      left: 40%;
      width: 400px;
      height: 400px;
      background: #005AAC;
      opacity: 0.2;
      animation: blob 30s infinite alternate;
    }

    @keyframes blob {
      0% {
        transform: translate(0, 0) scale(1);
      }

      100% {
        transform: translate(30px, 30px) scale(1.1);
      }
    }

    .glass-card {
      background: rgba(20, 20, 20, 0.6);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
    }

    .word-cloud-word {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      margin: 0.25rem;
      border-radius: 9999px;
      transition: all 0.3s ease;
      animation: float 3s ease-in-out infinite;
    }

    .word-cloud-word:nth-child(odd) {
      animation-delay: -1.5s;
    }

    @keyframes float {

      0%,
      100% {
        transform: translateY(0px);
      }

      50% {
        transform: translateY(-5px);
      }
    }

    @keyframes pulse-glow {

      0%,
      100% {
        box-shadow: 0 0 20px rgba(99, 102, 241, 0.3);
      }

      50% {
        box-shadow: 0 0 40px rgba(99, 102, 241, 0.6);
      }
    }

    .qr-glow {
      animation: pulse-glow 3s ease-in-out infinite;
    }

    @keyframes soundwave {

      0%,
      100% {
        transform: scaleY(0.3);
      }

      50% {
        transform: scaleY(1);
      }
    }

    .soundwave-bar {
      animation: soundwave 0.8s ease-in-out infinite;
    }

    .soundwave-bar:nth-child(1) {
      animation-delay: 0s;
    }

    .soundwave-bar:nth-child(2) {
      animation-delay: 0.1s;
    }

    .soundwave-bar:nth-child(3) {
      animation-delay: 0.2s;
    }

    .soundwave-bar:nth-child(4) {
      animation-delay: 0.3s;
    }

    .soundwave-bar:nth-child(5) {
      animation-delay: 0.4s;
    }

    .soundwave-bar:nth-child(6) {
      animation-delay: 0.5s;
    }

    .soundwave-bar:nth-child(7) {
      animation-delay: 0.6s;
    }

    .gradient-text {
      background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .progress-bar {
      background: linear-gradient(90deg, #6366f1 0%, #a855f7 100%);
    }
  </style>
</head>

<body class="bg-black text-white relative">
  <!-- Background Blobs -->
  <div class="blob blob-1"></div>
  <div class="blob blob-2"></div>
  <div class="blob blob-3"></div>

  <!-- Main Container -->
  <div class="min-h-screen w-full p-4 lg:p-6 flex flex-col relative z-10">

    <!-- Header -->
    <header class="flex flex-col md:flex-row items-center justify-between mb-6 gap-4 md:gap-0">
      <div class="flex items-center gap-3">
        <div
          class="w-10 h-10 rounded-xl bg-gradient-to-br from-primary to-accent flex items-center justify-center shadow-lg shadow-indigo-500/20">
          <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3" />
          </svg>
        </div>
        <div>
          <h1 class="text-2xl font-bold tracking-tight">JioAI Music</h1>
          <p class="text-sm text-white/60 font-medium">Birthday Celebration</p>
        </div>
      </div>

      <div class="flex items-center gap-6">
        <div class="flex items-center gap-2 bg-white/5 border border-white/10 px-4 py-2 rounded-full backdrop-blur-md">
          <div class="w-2 h-2 rounded-full bg-red-500 animate-pulse"></div>
          <span class="text-sm font-medium text-white/90">Live Event</span>
        </div>
        <div class="text-right">
          <p class="text-xs text-white/50 uppercase tracking-wider font-semibold">Guest of Honor</p>
          <p class="text-xl font-bold gradient-text">Mr. Anish Shah</p>
        </div>
      </div>
    </header>

    <!-- Main Content - Responsive Grid Layout -->
    <main class="flex-1 grid grid-cols-1 lg:grid-cols-12 gap-6">

      <!-- Section 1: QR Code Scanner -->
      <section class="col-span-1 lg:col-span-3 flex flex-col">
        <div class="glass-card rounded-2xl p-6 flex-1 flex flex-col">
          <div class="text-center mb-4">
            <span
              class="inline-flex items-center gap-2 bg-primary/20 text-indigo-300 px-3 py-1 rounded-full text-xs font-bold mb-3 border border-primary/20">
              <span class="w-1.5 h-1.5 rounded-full bg-indigo-400 animate-pulse"></span>
              STEP 1
            </span>
            <h2 class="text-xl font-bold mb-1 text-white">Scan & Share</h2>
            <p class="text-sm text-white/60">Describe the guest in one word</p>
          </div>

          <!-- QR Code -->
          <div class="flex-1 flex items-center justify-center">
            <div class="qr-glow rounded-2xl p-1 bg-gradient-to-br from-indigo-500 to-purple-500">
              <div class="bg-white p-4 rounded-xl">
                <!-- Using the same SVG but keeping it simple for now or Image -->
                <img
                  src="https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=https://jioaimusic.netlify.app/word-submit.html&color=4f46e5"
                  alt="QR Code" class="w-40 h-40 block">
              </div>
            </div>
          </div>

          <!-- Stats -->
          <div class="mt-4 pt-4 border-t border-white/10">
            <div class="flex items-center justify-between">
              <div class="text-center">
                <p class="text-2xl font-bold text-indigo-400">47</p>
                <p class="text-xs text-white/50 font-medium uppercase tracking-wide">Responses</p>
              </div>
              <div class="h-8 w-px bg-white/10"></div>
              <div class="text-center">
                <p class="text-2xl font-bold text-purple-400">23</p>
                <p class="text-xs text-white/50 font-medium uppercase tracking-wide">Unique Words</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Section 2: Word Cloud -->
      <section class="col-span-1 lg:col-span-5 flex flex-col">
        <div class="glass-card rounded-2xl p-6 flex-1 flex flex-col">
          <div class="text-center mb-4">
            <span
              class="inline-flex items-center gap-2 bg-purple-500/20 text-purple-300 px-3 py-1 rounded-full text-xs font-bold mb-3 border border-purple-500/20">
              <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                <path d="M10 2a8 8 0 100 16 8 8 0 000-16zm1 11H9v-2h2v2zm0-4H9V5h2v4z" />
              </svg>
              LIVE RESULTS
            </span>
            <h2 class="text-xl font-bold mb-1 text-white">What Makes Anish Shah Special?</h2>
            <p class="text-sm text-white/60">Words from friends & family</p>
          </div>

          <!-- Word Cloud Display -->
          <div class="flex-1 flex items-center justify-center p-4 overflow-hidden relative" id="wordCloudContainer">
            <div class="text-center leading-loose" id="wordsList">
              <span class="text-white/50">Waiting for words...</span>
            </div>
          </div>

          <!-- Recently Added -->
          <!-- Recently Added -->
          <div class="mt-4 pt-4 border-t border-white/10">
            <p class="text-xs text-white/40 mb-2 uppercase tracking-widest font-bold">Recently Added</p>
            <div class="flex items-center gap-2 flex-wrap" id="recentWords">
              <!-- Recent words will appear here -->
            </div>
          </div>

          <!-- Admin Controls -->
          <div class="mt-4 pt-4 border-t border-white/10 flex gap-3">
            <button onclick="goToGenerateSong()"
              class="flex-1 bg-white text-black py-2 px-4 rounded-xl font-bold hover:bg-gray-200 transition-colors flex items-center justify-center gap-2 text-sm">
              <span>üéµ</span> Generate
            </button>
            <button onclick="toggleSongConfig()"
              class="bg-white/5 text-white py-2 px-4 rounded-xl font-semibold hover:bg-white/10 transition-colors border border-white/10 flex items-center justify-center gap-2 text-sm">
              <span>‚öôÔ∏è</span> Advance <span id="configArrow" class="transition-transform duration-300">‚ñº</span>
            </button>
          </div>
        </div>
      </section>

      <!-- Section 3: AI Song Generation -->
      <section class="col-span-1 lg:col-span-4 flex flex-col">
        <div class="glass-card rounded-2xl p-6 flex-1 flex flex-col">
          <div class="text-center mb-4">
            <span
              class="inline-flex items-center gap-2 bg-gradient-to-r from-indigo-500 to-purple-500 text-white px-3 py-1 rounded-full text-xs font-bold mb-3 shadow-lg shadow-indigo-500/20">
              <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                <path
                  d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" />
              </svg>
              AI GENERATED
            </span>
            <h2 class="text-xl font-bold mb-1 text-white">Anish Shah's Song</h2>
            <p class="text-sm text-white/60">Powered by your words</p>
          </div>

          <!-- Album Art & Player -->
          <div class="flex-1 flex flex-col items-center justify-center">
            <!-- Album Art -->
            <div class="relative mb-6 group">
              <div
                class="w-48 h-48 rounded-2xl bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 overflow-hidden shadow-2xl relative">
                <div class="absolute inset-0 bg-black/10"></div>
                <div class="w-full h-full flex items-center justify-center relative z-10">
                  <svg class="w-20 h-20 text-white/90 drop-shadow-md" fill="none" stroke="currentColor"
                    viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                      d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3" />
                  </svg>
                </div>
              </div>

              <!-- Soundwave Animation -->
              <div class="absolute -bottom-3 left-1/2 -translate-x-1/2 flex items-end gap-1 h-8">
                <div class="soundwave-bar w-1.5 bg-indigo-400 rounded-full origin-bottom" style="height: 100%"></div>
                <div class="soundwave-bar w-1.5 bg-purple-400 rounded-full origin-bottom" style="height: 80%"></div>
                <div class="soundwave-bar w-1.5 bg-pink-400 rounded-full origin-bottom" style="height: 100%"></div>
                <div class="soundwave-bar w-1.5 bg-indigo-400 rounded-full origin-bottom" style="height: 60%"></div>
                <div class="soundwave-bar w-1.5 bg-purple-400 rounded-full origin-bottom" style="height: 90%"></div>
              </div>
            </div>

            <!-- Song Info -->
            <div class="text-center mb-6">
              <h3 class="text-xl font-bold mb-1 text-white">"Brilliant & Kind"</h3>
              <p class="text-sm text-white/50">A song for Anish Shah</p>
            </div>

            <!-- Progress Bar -->
            <div class="w-full max-w-xs mb-6">
              <div class="h-1.5 bg-white/10 rounded-full overflow-hidden">
                <div class="progress-bar h-full rounded-full" style="width: 65%"></div>
              </div>
              <div class="flex justify-between text-xs text-white/40 mt-2 font-medium">
                <span>1:42</span>
                <span>2:38</span>
              </div>
            </div>

            <!-- Playback Controls -->
            <div class="flex items-center gap-6">
              <button
                class="w-12 h-12 rounded-full bg-white/5 border border-white/10 flex items-center justify-center text-white/70 hover:bg-white/10 hover:text-white transition-all">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M8.445 14.832A1 1 0 0010 14v-4a1 1 0 00-1.555-.832l-3 2a1 1 0 000 1.664l3 2z" />
                  <path d="M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2H4zm0 2h12v8H4V6z" />
                </svg>
              </button>

              <button
                class="w-16 h-16 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white hover:scale-105 transition-transform shadow-lg shadow-indigo-500/30">
                <svg class="w-8 h-8 ml-1" fill="currentColor" viewBox="0 0 20 20">
                  <path
                    d="M6.3 2.841A1.5 1.5 0 004 4.11V15.89a1.5 1.5 0 002.3 1.269l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z" />
                </svg>
              </button>

              <button
                class="w-12 h-12 rounded-full bg-white/5 border border-white/10 flex items-center justify-center text-white/70 hover:bg-white/10 hover:text-white transition-all">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                  <path
                    d="M4.555 5.168A1 1 0 003 6v8a1 1 0 001.555.832L8 12.202V14a1 1 0 001.555.832l4-2.5a1 1 0 000-1.664l-4-2.5A1 1 0 008 9v1.798L4.555 5.168z" />
                </svg>
              </button>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="mt-6 pt-6 border-t border-white/10">
            <div class="grid grid-cols-2 gap-4">
              <button
                class="flex items-center justify-center gap-2 bg-white text-black py-3 px-4 rounded-xl font-bold hover:bg-gray-200 transition-colors">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                </svg>
                Generate
              </button>
              <button
                class="flex items-center justify-center gap-2 bg-white/5 text-white py-3 px-4 rounded-xl font-semibold hover:bg-white/10 transition-colors border border-white/10">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" />
                </svg>
                Share
              </button>
            </div>
          </div>
        </div>
      </section>
      </section>

      <!-- Section 4: Song Configuration (Hidden) -->
      <section class="col-span-1 lg:col-span-12 hidden" id="songConfigCard">
        <div class="glass-card rounded-2xl p-6 relative overflow-hidden">
          <!-- Blobs for internal depth -->
          <div
            class="absolute top-0 right-0 w-64 h-64 bg-purple-500/20 rounded-full blur-3xl pointer-events-none -mr-32 -mt-32">
          </div>

          <h2 class="text-xl font-bold mb-6 text-white flex items-center gap-2">
            <span>‚öôÔ∏è</span> Create Personalized Song
          </h2>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div class="space-y-6">
              <div>
                <label class="block text-xs font-bold text-white/60 uppercase tracking-widest mb-2">Person Name</label>
                <input type="text" id="personName" placeholder="e.g., Anish Bhai" value="Anish Bhai"
                  class="w-full bg-black/40 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-white/30 focus:outline-none focus:border-indigo-500/50 focus:ring-1 focus:ring-indigo-500/50 transition-all font-medium">
              </div>
            </div>

            <div class="space-y-6">
              <div>
                <label class="block text-xs font-bold text-white/60 uppercase tracking-widest mb-2">Occasion</label>
                <input type="text" id="occasion" placeholder="e.g. Birthday Celebration" value="Birthday Celebration"
                  class="w-full bg-black/40 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-white/30 focus:outline-none focus:border-purple-500/50 focus:ring-1 focus:ring-purple-500/50 transition-all font-medium">
              </div>
            </div>
          </div>

          <!-- Prompt Preview -->
          <div class="mt-8 pt-6 border-t border-white/10">
            <label class="block text-xs font-bold text-white/60 uppercase tracking-widest mb-2">Prompt Preview</label>
            <div id="promptPreview"
              class="bg-black/20 rounded-xl p-4 text-white/80 font-mono text-sm leading-relaxed border border-white/5 min-h-[80px]">
              Waiting for words...
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- Footer -->
    <footer
      class="mt-6 flex flex-col md:flex-row items-center justify-between text-sm text-white/40 font-medium gap-4 md:gap-0">
      <p>Powered by AI ‚Ä¢ Making celebrations unforgettable</p>
      <div class="flex items-center gap-4">
        <button class="hover:text-white transition-colors">Settings</button>
        <button class="hover:text-white transition-colors">Help</button>
        <button
          class="px-3 py-1 bg-white/5 border border-white/10 rounded-lg hover:bg-white/10 transition-colors text-white/90">
          New Guest
        </button>
      </div>
    </footer>
  </div>
  <script>
    const API_BASE = 'https://my-suno-backend.onrender.com'; // Adjust if needed
    let currentWords = [];
    const wordsListEl = document.getElementById('wordsList');
    const recentWordsEl = document.getElementById('recentWords');
    const totalResponsesEl = document.querySelector('.text-2xl.font-bold.text-indigo-400'); // Valid Selector Update Needed
    const uniqueWordsEl = document.querySelector('.text-2xl.font-bold.text-purple-400');   // Valid Selector Update Needed

    // Styles for dynamic bubbles
    const bubbleStyles = [
      "text-4xl font-bold text-indigo-300 bg-indigo-500/10 border border-indigo-500/20",
      "text-2xl font-medium text-purple-300 bg-purple-500/10 border border-purple-500/20",
      "text-3xl font-semibold text-white bg-white/5 border border-white/10",
      "text-xl text-indigo-200 bg-indigo-500/5 border border-indigo-500/10",
      "text-4xl font-bold text-pink-400 bg-pink-500/10 border border-pink-500/20",
      "text-2xl font-medium text-indigo-300 bg-indigo-500/10 border border-indigo-500/20",
      "text-xl text-white/70 bg-white/5",
      "text-3xl font-semibold text-white bg-white/5 border border-white/10"
    ];

    const recentStyles = [
      "px-3 py-1 bg-indigo-500/20 text-indigo-300 text-sm rounded-full font-medium animate-pulse border border-indigo-500/30",
      "px-3 py-1 bg-purple-500/20 text-purple-300 text-sm rounded-full font-medium border border-purple-500/30",
      "px-3 py-1 bg-white/10 text-white/80 text-sm rounded-full font-medium border border-white/10"
    ];

    let rawWords = []; // To store raw API response for comparison

    async function fetchWords() {
      try {
        const response = await fetch(`${API_BASE}/api/words`);
        const data = await response.json();
        const newWords = data.words || [];

        // Compare new API data with our stored raw data
        if (JSON.stringify(newWords) !== JSON.stringify(rawWords)) {
          rawWords = newWords; // Update stored raw data
          currentWords = [...newWords].reverse(); // Create reversed copy for display
          updateUI();
        }
      } catch (error) {
        console.error('Error fetching words:', error);
      }
    }

    function updateUI() {
      if (currentWords.length === 0) {
        wordsListEl.innerHTML = '<span class="text-white/50">Waiting for words...</span>';
        recentWordsEl.innerHTML = '';
        updateStats(0, 0);
        return;
      }

      // 1. Calculate Frequency
      const frequencyMap = {};
      currentWords.forEach(word => {
        const normalized = word.trim().toLowerCase();
        if (normalized) {
          // Store original casing of first occurrence or just capitalize
          const key = normalized;
          frequencyMap[key] = (frequencyMap[key] || 0) + 1;
        }
      });

      const uniqueWords = Object.keys(frequencyMap);
      updateStats(currentWords.length, uniqueWords.length);

      // 2. Determine Scale
      // Find min and max frequency to normalize sizes
      let maxFreq = 0;
      let minFreq = Infinity;

      uniqueWords.forEach(w => {
        const count = frequencyMap[w];
        if (count > maxFreq) maxFreq = count;
        if (count < minFreq) minFreq = count;
      });

      // Base sizes in rem
      const minSize = 1.0;
      const maxSize = 3.5;

      // 3. Render Cloud
      // Render all unique words
      const cloudHTML = uniqueWords.map((key, index) => {
        const count = frequencyMap[key];
        const originalText = key.charAt(0).toUpperCase() + key.slice(1); // Capitalize display

        // Calculate size: Linear interpolation
        let size = minSize;
        if (maxFreq > minFreq) {
          size = minSize + ((count - minFreq) / (maxFreq - minFreq)) * (maxSize - minSize);
        } else {
          size = (minSize + maxSize) / 2;
        }

        const styleClass = bubbleStyles[index % bubbleStyles.length];

        return `<span class="word-cloud-word ${styleClass}" style="font-size: ${size.toFixed(2)}rem;">${originalText}</span>`;
      }).join('');

      wordsListEl.innerHTML = cloudHTML;

      // 4. Update Recently Added (Top 3 from raw list)
      // currentWords is reversed (newest first)
      const recent3 = currentWords.slice(0, 3);
      recentWordsEl.innerHTML = recent3.map((word, index) => {
        const style = recentStyles[index % recentStyles.length];
        return `<span class="${style}">+ ${word}</span>`;
      }).join('');
    }

    function updateStats(total, unique) {
      if (totalResponsesEl) totalResponsesEl.textContent = total;
      if (uniqueWordsEl) uniqueWordsEl.textContent = unique;
    }

    // Initial Load
    fetchWords();

    // Poll every 2 seconds
    setInterval(fetchWords, 2000);


    // --- New Functionalities ---

    document.addEventListener('DOMContentLoaded', () => {
      // Setup input listeners for dynamic prompt preview
      const personNameInput = document.getElementById('personName');
      const occasionInput = document.getElementById('occasion');

      if (personNameInput) personNameInput.addEventListener('input', updatePromptPreview);
      if (occasionInput) occasionInput.addEventListener('input', updatePromptPreview);
    });

    function updatePromptPreview() {
      const promptPreview = document.getElementById('promptPreview');
      if (!promptPreview) return;

      const personName = document.getElementById('personName').value.trim();
      const occasion = document.getElementById('occasion').value.trim();

      if (currentWords.length === 0) {
        promptPreview.textContent = 'Waiting for words...';
        return;
      }

      // Calculate Stats for Preview
      const frequency = {};
      currentWords.forEach(word => {
        const normalized = word.toLowerCase();
        frequency[normalized] = (frequency[normalized] || 0) + 1;
      });

      // Sort by frequency
      let sortedUniqueWords = Object.entries(frequency)
        .sort((a, b) => b[1] - a[1])
        .map(([word]) => word.charAt(0).toUpperCase() + word.slice(1));

      // Take top 15 for prompt
      const topWords = sortedUniqueWords.slice(0, 15).join(', ');

      let text = "";
      if (!personName && !occasion) {
        text = `Create a song for a person. Their qualities are: ${topWords}`;
      } else if (!personName) {
        text = `Create a song for ${occasion}. Their qualities are: ${topWords}`;
      } else if (!occasion) {
        text = `Create a song for ${personName}. Their qualities are: ${topWords}`;
      } else {
        text = `Create a song for ${personName} for their ${occasion}. Their qualities are: ${topWords}`;
      }

      promptPreview.textContent = text;
    }

    function toggleSongConfig() {
      const card = document.getElementById('songConfigCard');
      const arrow = document.getElementById('configArrow');

      if (card.classList.contains('hidden')) {
        card.classList.remove('hidden');
        if (arrow) arrow.style.transform = 'rotate(180deg)';
        // Smooth scroll to it
        setTimeout(() => card.scrollIntoView({ behavior: 'smooth', block: 'end' }), 100);
        updatePromptPreview(); // Update on open
      } else {
        card.classList.add('hidden');
        if (arrow) arrow.style.transform = 'rotate(0deg)';
      }
    }

    function goToGenerateSong() {
      if (currentWords.length === 0) {
        alert('No words collected yet! Please collect some words first.');
        return;
      }

      const personName = document.getElementById('personName').value.trim();
      const occasion = document.getElementById('occasion').value.trim();

      // Re-calculate simply for the prompt generation
      const frequency = {};
      currentWords.forEach(word => {
        const normalized = word.toLowerCase();
        frequency[normalized] = (frequency[normalized] || 0) + 1;
      });

      let sortedUniqueWords = Object.entries(frequency)
        .sort((a, b) => b[1] - a[1])
        .map(([word]) => word.charAt(0).toUpperCase() + word.slice(1));

      const qualities = sortedUniqueWords.slice(0, 15).join(', ');

      let prompt;
      if (!personName && !occasion) {
        prompt = `Create a song for a person. Their qualities are: ${qualities}`;
      } else if (!personName) {
        prompt = `Create a song for ${occasion}. Their qualities are: ${qualities}`;
      } else if (!occasion) {
        prompt = `Create a song for ${personName}. Their qualities are: ${qualities}`;
      } else {
        prompt = `Create a song for ${personName} for their ${occasion}. Their qualities are: ${qualities}`;
      }

      const encodedPrompt = encodeURIComponent(prompt);
      // Redirect to root with prompt param (assuming that's where the generator lives)
      window.location.href = `/?prompt=${encodedPrompt}`;
    }

    // Hook updatePromptPreview into updateUI to keep it live
    const originalUpdateUI = updateUI;
    updateUI = function () {
      originalUpdateUI();
      updatePromptPreview();
    }

  </script>
</body>

</html>