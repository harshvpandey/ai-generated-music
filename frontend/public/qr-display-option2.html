<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Display - Option 2: Dynamic Grid</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: #000000;
            color: white;
            min-height: 100vh;
            /* Mobile viewport height fix */
            min-height: -webkit-fill-available;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow-x: hidden;
            overflow-y: auto;
            position: relative;
        }

        /* Animated Background */
        .blob {
            position: absolute;
            border-radius: 50%;
            filter: blur(100px);
            opacity: 0.5;
            z-index: 0;
        }

        .blob-1 {
            top: -20%;
            left: -10%;
            width: 600px;
            height: 600px;
            background: #4f46e5;
            animation: blob 25s infinite alternate;
        }

        .blob-2 {
            bottom: -20%;
            right: -10%;
            width: 600px;
            height: 600px;
            background: #db2777;
            animation: blob 25s infinite alternate-reverse;
        }

        @keyframes blob {
            0% {
                transform: translate(0, 0) scale(1);
            }

            100% {
                transform: translate(50px, 50px) scale(1.1);
            }
        }

        .container {
            position: relative;
            z-index: 10;
            max-width: 1200px;
            padding: 2rem;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
            align-items: center;
        }

        .left-section {
            text-align: left;
        }

        h1 {
            font-size: 5rem;
            font-weight: 800;
            background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1.5rem;
            line-height: 1.1;
        }

        .description {
            font-size: 1.3rem;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        .stats {
            display: flex;
            gap: 2rem;
            margin-top: 2rem;
        }

        .stat-box {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1rem;
            padding: 1.5rem;
            flex: 1;
            backdrop-filter: blur(10px);
        }

        .stat-number {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.5);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-top: 0.5rem;
        }

        .right-section {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 2rem;
        }

        .qr-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 2.5rem;
            padding: 3rem;
            box-shadow: 0 40px 80px -20px rgba(0, 0, 0, 0.7),
                inset 0 0 30px rgba(255, 255, 255, 0.05);
            position: relative;
            overflow: hidden;
            transition: transform 0.4s ease, box-shadow 0.4s ease;
        }

        .qr-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 50px 90px -20px rgba(0, 0, 0, 0.8),
                inset 0 0 30px rgba(255, 255, 255, 0.08);
        }

        .qr-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #6366f1, #a855f7, #ec4899);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% {
                background-position: -200% 0;
            }

            100% {
                background-position: 200% 0;
            }
        }

        .qr-code {
            width: 100%;
            max-width: 320px;
            aspect-ratio: 1/1;
            height: auto;
            background: white;
            border-radius: 2rem;
            margin: 0 auto 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease;
        }

        .qr-code:hover {
            transform: scale(1.02);
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.4);
        }

        .qr-placeholder {
            font-size: 1rem;
            color: #666;
            font-weight: 500;
        }

        .scan-text {
            text-align: center;
            font-size: 1.1rem;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 500;
        }

        .words-preview {
            margin-top: 2rem;
            padding: 1.5rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.05);
            max-height: 150px;
            overflow-y: auto;
        }

        .word-tag {
            display: inline-block;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(168, 85, 247, 0.2));
            border: 1px solid rgba(99, 102, 241, 0.3);
            padding: 0.5rem 1rem;
            border-radius: 2rem;
            margin: 0.25rem;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.9);
        }

        @media (max-width: 968px) {
            body {
                height: auto;
                padding: 2rem 0;
            }

            .container {
                grid-template-columns: 1fr;
                text-align: center;
                gap: 2rem;
                padding: 1rem;
            }

            .left-section {
                text-align: center;
                order: 2;
                /* Put text below QR on mobile if desired, or keep as is. Let's keep text on top/left first usually. */
            }

            /* Actually, usually QR is better below intro content on mobile. Let's stick to default order (left section first) */

            h1 {
                font-size: clamp(3rem, 8vw, 4rem);
            }

            .qr-card {
                padding: 2rem;
                width: 100%;
                max-width: 400px;
            }
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 2.5rem;
            }

            .qr-card {
                padding: 1.5rem;
            }

            .stat-number {
                font-size: 2rem;
            }

            .container {
                padding: 1rem;
            }
        }
    </style>
</head>

<body>
    <!-- Background Blobs -->
    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>

    <!-- Fixed Settings UI -->
    <button onclick="toggleEdit()" title="Configure QR URL"
        style="position: fixed; bottom: 30px; right: 30px; width: 50px; height: 50px; background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); color: white; cursor: pointer; border-radius: 50%; z-index: 9999; box-shadow: 0 4px 15px rgba(0,0,0,0.5); transition: all 0.3s ease; display: flex; align-items: center; justify-content: center;">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
                d="M12 15C13.6569 15 15 13.6569 15 12C15 10.3431 13.6569 9 12 9C10.3431 9 9 10.3431 9 12C9 13.6569 10.3431 15 12 15Z"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            <path
                d="M19.4 15C20.6 15 21.6 15.6 22 16.6C22.4 17.6 22.1 18.8 21.2 19.5L20.2 20.2C19.4 20.8 19 21.8 19.1 22.8L19.2 24H4.8L4.9 22.8C5 21.8 4.6 20.8 3.8 20.2L2.8 19.5C1.9 18.8 1.6 17.6 2 16.6C2.4 15.6 3.4 15 4.6 15H19.4Z"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" opacity="0.8" />
            <path
                d="M12.22 2H11.78C9.59997 2.01 7.74997 3.52 7.24997 5.64C7.09997 6.28 6.55997 6.78 5.89997 6.88C3.71997 7.21 2.15997 9.21 2.42997 11.4C2.50997 12.1 2.50997 12.81 2.42997 13.51C2.14997 15.7 3.71997 17.7 5.89997 18.03C6.55997 18.13 7.09997 18.63 7.24997 19.27C7.74997 21.39 9.59997 22.9 11.78 22.91H12.22C14.4 22.9 16.25 21.39 16.75 19.27C16.9 18.63 17.44 18.13 18.1 18.03C20.28 17.7 21.84 15.7 21.57 13.51C21.49 12.81 21.49 12.1 21.57 11.4C21.85 9.21 20.28 7.21 18.1 6.88C17.44 6.78 16.9 6.28 16.75 5.64C16.25 3.52 14.4 2.01 12.22 2Z"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
        </svg>
    </button>

    <div class="container">
        <div class="left-section">
            <h1>Create Together</h1>
            <p class="description">
                Every leader contributes one word. Together, we'll create a unique AI-generated song that captures our
                collective vision.
            </p>

            <div class="stats">
                <div class="stat-box">
                    <div class="stat-number" id="wordCount">0</div>
                    <div class="stat-label">Words Collected</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="participantCount">0</div>
                    <div class="stat-label">Participants</div>
                </div>
            </div>

            <div class="words-preview" id="wordsPreview">
                <!-- Words will appear here -->
                <div style="text-align: center; color: rgba(255,255,255,0.3);">Waiting for words...</div>
            </div>
        </div>

        <div class="right-section">
            <p class="scan-text">Scan to contribute your word</p>
            <div class="qr-card">
                <div style="position: relative;">
                    <img id="qrImage" src="" alt="Scan to Submit"
                        style="width: 100%; height: 100%; object-fit: contain; padding: 20px;">
                    <!-- Button removed -->
                </div>
            </div>
            <div id="editContainer" style="display: none; margin-top: 10px;">
                <input type="text" id="qrUrlInput" placeholder="Enter URL"
                    style="width: 100%; padding: 8px; border-radius: 5px; border: 1px solid #444; background: #222; color: white;">
                <button onclick="saveQrUrl()"
                    style="margin-top: 5px; width: 100%; padding: 8px; background: #6366f1; color: white; border: none; border-radius: 5px; cursor: pointer;">Update
                    QR</button>
            </div>
        </div>
    </div>
    </div>
    </div>

    <script>
        // QR Code Logic
        const DEFAULT_URL = window.location.origin + '/public/word-submit.html'; // Auto-detect current host!
        const qrImage = document.getElementById('qrImage');
        const editContainer = document.getElementById('editContainer');
        const qrUrlInput = document.getElementById('qrUrlInput');

        function generateQrUrl(dataUrl) {
            return `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(dataUrl)}&color=000000`;
        }

        function loadQr() {
            const savedUrl = localStorage.getItem('qr_target_url') || DEFAULT_URL;
            qrImage.src = generateQrUrl(savedUrl);
            qrUrlInput.value = savedUrl;
        }

        function toggleEdit() {
            editContainer.style.display = editContainer.style.display === 'none' ? 'block' : 'none';
            // Move edit container to be fixed near the button if needed, or leave it in card.
            // Since the button is now far away, let's make the edit container fixed too so context isn't lost.
            if (editContainer.style.display === 'block') {
                editContainer.style.position = 'fixed';
                editContainer.style.bottom = '80px';
                editContainer.style.right = '20px';
                editContainer.style.zIndex = '1001';
                editContainer.style.background = 'rgba(0,0,0,0.9)';
                editContainer.style.padding = '15px';
                editContainer.style.borderRadius = '10px';
                editContainer.style.border = '1px solid #444';
                editContainer.style.width = '300px';
            }
        }

        function saveQrUrl() {
            const newUrl = qrUrlInput.value.trim();
            if (newUrl) {
                localStorage.setItem('qr_target_url', newUrl);
                loadQr();
                toggleEdit();
            }
        }

        // Initialize QR
        loadQr();

        // Real-time updates
        function updateDisplay() {
            // Use absolute path for API to ensure it works on port 8080 too
            fetch('http://localhost:8000/api/words')
                .then(res => res.json())
                .then(data => {
                    document.getElementById('wordCount').textContent = data.count || data.words.length; // Handle both formats

                    // Update participants count
                    if (data.participants !== undefined) {
                        document.getElementById('participantCount').textContent = data.participants;
                    } else {
                        // Fallback if API doesn't return participants
                        document.getElementById('participantCount').textContent = data.count || data.words.length;
                    }

                    const preview = document.getElementById('wordsPreview');
                    if (data.words && data.words.length > 0) {
                        preview.innerHTML = data.words.map(word =>
                            `<span class="word-tag">${word}</span>`
                        ).join('');
                    } else {
                        preview.innerHTML = '<div style="text-align: center; color: rgba(255,255,255,0.3);">Waiting for words...</div>';
                    }
                })
                .catch(err => console.error(err));
        }

        setInterval(updateDisplay, 2000);
        updateDisplay();
    </script>
</body>

</html>